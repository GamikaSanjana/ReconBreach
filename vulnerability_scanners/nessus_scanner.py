import requests

def scan_with_nessus(target, nessus_url, api_key):
    headers = {'X-ApiKeys': f'key={api_key}'}
    url = f'{nessus_url}/scans'
    data = {
        'targets': target,
        'scan_name': 'ReconBreach Scan'
    }
    response = requests.post(url, headers=headers, data=data)
    scan_id = response.json()['scan']['id']
    print(f"[*] Scan ID: {scan_id} created for {target}")
    return scan_id

def fetch_nessus_results(scan_id, nessus_url, api_key):
    headers = {'X-ApiKeys': f'key={api_key}'}
    url = f'{nessus_url}/scans/{scan_id}'
    response = requests.get(url, headers=headers)
    results = response.json()
    return results

def nessus_scan(target, nessus_url, api_key):
    scan_id = scan_with_nessus(target, nessus_url, api_key)
    results = fetch_nessus_results(scan_id, nessus_url, api_key)
    return results
