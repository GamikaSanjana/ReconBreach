import requests

def scan_with_openvas(target, openvas_url, api_key):
    headers = {'Authorization': f'Bearer {api_key}'}
    url = f'{openvas_url}/scans'
    data = {
        'target': target,
        'scan_name': 'ReconBreach Scan'
    }
    response = requests.post(url, headers=headers, json=data)
    scan_id = response.json()['scan_id']
    print(f"[*] Scan ID: {scan_id} created for {target}")
    return scan_id

def fetch_openvas_results(scan_id, openvas_url, api_key):
    headers = {'Authorization': f'Bearer {api_key}'}
    url = f'{openvas_url}/scans/{scan_id}'
    response = requests.get(url, headers=headers)
    results = response.json()
    return results

def openvas_scan(target, openvas_url, api_key):
    scan_id = scan_with_openvas(target, openvas_url, api_key)
    results = fetch_openvas_results(scan_id, openvas_url, api_key)
    return results
